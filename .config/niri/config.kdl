// Niri configuration (ported from black-don-os Nix setup)
// Arch version â€“ no Nix interpolation, just plain KDL.

// =======================
// Outputs (monitors)
// =======================
// If you know your output names (check: `niri msg outputs` or `journalctl -b | grep DRM`)
// put your own output blocks here. Example:
//
// output "DP-1" {
//     mode 2560 1440 165.00
//     position x=0 y=0
// }
//
// For now we omit host-specific output config.

// =======================
// Layout / Input / Animations
// =======================

config-notification {
    disable-failed
}

gestures {
    hot-corners {
        off
    }
}

input {
    keyboard {
        xkb {
            options "caps:swapescape"
        }
        numlock
    }
    touchpad {
        natural-scroll
    }
    mouse {
        accel-profile "flat"
        accel-speed -0.7
    }
    trackpoint {
    }

    // focus-follows-mouse
    warp-mouse-to-focus
}

layout {
    gaps 9

    center-focused-column "never"
    always-center-single-column

    preset-column-widths {
        proportion 0.25
        proportion 0.45
        proportion 0.65
        proportion 0.85
        proportion 1.00
    }

    default-column-width { proportion 0.45; }

    border {
        width 2
        active-color "#cba6f7"
        inactive-color "#45475a"
        urgent-color "#f5c2e7"
    }

    focus-ring {
        off
    }

    shadow {
        softness 30
        spread 5
        offset x=0 y=5
        color "#0007"
    }

}

overview {
    backdrop-color "#1e1e2e"

    workspace-shadow {
        softness 40
        spread 10
        offset x=0 y=10
        color "#00000050"
    }

    zoom 0.25
}

animations {
    off
    slowdown 0.5
}

binds {
    // === System & Overview ===
    Mod+X repeat=false { toggle-overview; }
    Mod+O repeat=false { toggle-overview; }
    Mod+Shift+Slash { show-hotkey-overlay; }

    // === Application Launchers ===
    Mod+T { spawn "kitty"; }          // terminal
    Mod+Return { spawn "kitty"; }
    Mod+Y { spawn "fuzzel"; }         // app launcher
    Mod+Space { spawn "rofi" "-show" "drun"; } // launcher for waybar setup

    // === Security ===
    Ctrl+Alt+Backspace { spawn "hyprlock"; }
    Mod+Shift+Q { quit; }
    Ctrl+Alt+Delete { quit; }

    // === Keyboard Brightness Controls ===
    XF86KbdBrightnessUp allow-when-locked=true {
        spawn "kbdbrite.sh" "up";
    }
    XF86KbdBrightnessDown allow-when-locked=true {
        spawn "kbdbrite.sh" "down";
    }

    // === Window Management ===
    Mod+Q repeat=false { close-window; }
    Mod+Alt+F { maximize-column; }
    Mod+F { fullscreen-window; }
    Mod+W { toggle-window-floating; }
    Mod+Ctrl+W { switch-focus-between-floating-and-tiling; }
    Mod+V { toggle-column-tabbed-display; }

    // === Column/Window Focus (Mod+ = column nav) ===
    Mod+Left  { focus-column-left; }
    Mod+Right { focus-column-right; }
    Mod+Up    { focus-window-up; }
    Mod+Down  { focus-window-down; }

    Mod+H { focus-column-left; }
    Mod+L { focus-column-right; }
    Mod+K { focus-window-up; }
    Mod+J { focus-window-down; }

    Mod+Home { focus-column-first; }
    Mod+End  { focus-column-last; }

    // === Move Inside Workspace (Mod+Shift+ = move stuff in same workspace) ===
    Mod+Shift+Left  { move-column-left; }
    Mod+Shift+Right { move-column-right; }
    Mod+Shift+Up    { move-window-up; }
    Mod+Shift+Down  { move-window-down; }

    Mod+Shift+H { move-column-left; }
    Mod+Shift+L { move-column-right; }
    Mod+Shift+K { move-window-up; }
    Mod+Shift+J { move-window-down; }

    Mod+Shift+Home { move-column-to-first; }
    Mod+Shift+End  { move-column-to-last; }

    // === Workspace Navigation (Mod+Ctrl+ = workspace nav) ===
    // directional (up/down only make sense)
    Mod+Ctrl+Up   { focus-workspace-up; }
    Mod+Ctrl+Down { focus-workspace-down; }
    Mod+Ctrl+K    { focus-workspace-up; }
    Mod+Ctrl+J    { focus-workspace-down; }

    // === Move Across Workspaces (Mod+Ctrl+Shift+ = move stuff across workspaces) ===
    Mod+Ctrl+Shift+Up   { move-column-to-workspace-up; }
    Mod+Ctrl+Shift+Down { move-column-to-workspace-down; }
    Mod+Ctrl+Shift+K    { move-column-to-workspace-up; }
    Mod+Ctrl+Shift+J    { move-column-to-workspace-down; }

    // === Monitor Navigation (Alt layer) ===
    Mod+Alt+Left  { focus-monitor-left; }
    Mod+Alt+Right { focus-monitor-right; }
    Mod+Alt+Up    { focus-monitor-up; }
    Mod+Alt+Down  { focus-monitor-down; }

    Mod+Alt+H { focus-monitor-left; }
    Mod+Alt+L { focus-monitor-right; }
    Mod+Alt+K { focus-monitor-up; }
    Mod+Alt+J { focus-monitor-down; }

    // === Move Column Across Monitors (Alt+Shift = move column to monitor) ===
    Mod+Alt+Shift+Left  { move-column-to-monitor-left; }
    Mod+Alt+Shift+Right { move-column-to-monitor-right; }
    Mod+Alt+Shift+Up    { move-column-to-monitor-up; }
    Mod+Alt+Shift+Down  { move-column-to-monitor-down; }

    Mod+Alt+Shift+H { move-column-to-monitor-left; }
    Mod+Alt+Shift+L { move-column-to-monitor-right; }
    Mod+Alt+Shift+K { move-column-to-monitor-up; }
    Mod+Alt+Shift+J { move-column-to-monitor-down; }

    // === Workspace Reordering (still "move stuff") ===
    Mod+Shift+Page_Down { move-workspace-down; }
    Mod+Shift+Page_Up   { move-workspace-up; }

    // === Mouse Wheel Navigation ===
    // Vertical wheel = workspace nav / move between workspaces
    Mod+WheelScrollDown      cooldown-ms=150 { focus-workspace-down; }
    Mod+WheelScrollUp        cooldown-ms=150 { focus-workspace-up; }
    Mod+Ctrl+Shift+WheelScrollDown cooldown-ms=150 { move-column-to-workspace-down; }
    Mod+Ctrl+Shift+WheelScrollUp   cooldown-ms=150 { move-column-to-workspace-up; }

    // Horizontal wheel = columns (nav vs move-in-workspace)
    Mod+WheelScrollRight       { focus-column-right; }
    Mod+WheelScrollLeft        { focus-column-left; }
    Mod+Shift+WheelScrollRight { move-column-right; }
    Mod+Shift+WheelScrollLeft  { move-column-left; }

    // === Numbered Columns: Focus (Mod+1-9 = column nav) ===
    Mod+1 {
        focus-column-first;
    }
    Mod+2 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+3 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+4 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+5 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+6 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+7 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+8 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }
    Mod+9 {
        spawn-sh "niri msg action focus-column-first; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        niri msg action focus-column-right; \\
        ";
    }

    // === Numbered Columns: Move Inside Workspace (Mod+Shift+1-9) ===
    Mod+Shift+1 {
        move-column-to-first;
    }
    Mod+Shift+2 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+3 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+4 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+5 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+6 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+7 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+8 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }
    Mod+Shift+9 {
        spawn-sh "niri msg action move-column-to-first; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        niri msg action move-column-right; \\
        ";
    }

    // === Numbered Workspaces: Nav (Mod+Ctrl+1-9) ===
    Mod+Ctrl+1 { focus-workspace 1; }
    Mod+Ctrl+2 { focus-workspace 2; }
    Mod+Ctrl+3 { focus-workspace 3; }
    Mod+Ctrl+4 { focus-workspace 4; }
    Mod+Ctrl+5 { focus-workspace 5; }
    Mod+Ctrl+6 { focus-workspace 6; }
    Mod+Ctrl+7 { focus-workspace 7; }
    Mod+Ctrl+8 { focus-workspace 8; }
    Mod+Ctrl+9 { focus-workspace 9; }

    // === Numbered Workspaces: Move Column Across Workspaces (Mod+Ctrl+Shift+1-9) ===
    Mod+Ctrl+Shift+1 { move-column-to-workspace 1; }
    Mod+Ctrl+Shift+2 { move-column-to-workspace 2; }
    Mod+Ctrl+Shift+3 { move-column-to-workspace 3; }
    Mod+Ctrl+Shift+4 { move-column-to-workspace 4; }
    Mod+Ctrl+Shift+5 { move-column-to-workspace 5; }
    Mod+Ctrl+Shift+6 { move-column-to-workspace 6; }
    Mod+Ctrl+Shift+7 { move-column-to-workspace 7; }
    Mod+Ctrl+Shift+8 { move-column-to-workspace 8; }
    Mod+Ctrl+Shift+9 { move-column-to-workspace 9; }

    // === Column Management ===
    Mod+BracketLeft  { consume-or-expel-window-left; }
    Mod+BracketRight { consume-or-expel-window-right; }
    Mod+Period { expel-window-from-column; }

    // === Sizing & Layout ===
    Mod+R { switch-preset-column-width; }
    Mod+Shift+R { switch-preset-column-width-back; }
    Mod+Ctrl+R { reset-window-height; }
    Mod+Ctrl+F { expand-column-to-available-width; }
    Mod+C { center-column; }

    // === Manual Sizing ===
    Mod+Minus { set-column-width "-10%"; }
    Mod+Equal { set-column-width "+10%"; }
    Mod+Shift+Minus { set-window-height "-10%"; }
    Mod+Shift+Equal { set-window-height "+10%"; }

    // === Screenshots ===
    Mod+Shift+S { screenshot; }
    XF86Launch1 { screenshot; }
    Ctrl+XF86Launch1 { screenshot-screen; }
    Alt+XF86Launch1 { screenshot-window; }
    Print { screenshot; }
    Ctrl+Print { screenshot-screen; }
    Alt+Print { screenshot-window; }

    // === System Controls ===
    Mod+Escape { spawn "ignis" "open-window" "PowerMenu"; }
    Mod+Alt+P { power-off-monitors; }

    // === Custom Application Launchers ===
    Mod+B { spawn "firefox"; }
    Mod+D { spawn "vesktop"; }

    // === Color picker ===
    Mod+Shift+C { spawn-sh "niri msg pick-color | grep 'Hex:' | cut -d' ' -f2 | wl-copy"; }

    // === Dynamic Cast ===
    Mod+P { set-dynamic-cast-monitor; }
    Mod+Shift+P { set-dynamic-cast-window; }
    Mod+Ctrl+P { clear-dynamic-cast-target; }
}

// =======================
// Window rules
// =======================

window-rule {
    // Work around WezTerm's initial configure bug
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width {}
}

// Open the Firefox picture-in-picture player as floating by default
window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    open-floating true
}

// Global window styling
window-rule {
    geometry-corner-radius 10
    clip-to-geometry true
    draw-border-with-background false
}

// Opacity rules for specific applications
window-rule {
    match app-id=r#"^(kitty|thunar|org\.telegram\.desktop|discord|vesktop|org\.gnome\.Nautilus|nemo)$"#
    opacity 0.9
}

// Launch vesktop and Telegram on DP-3 monitor
window-rule {
    match app-id=r#"^(vesktop|org\.telegram\.desktop)$"#
    open-on-output "DP-3"
}

// OBS always opens at full width on DP-2
window-rule {
    match app-id=r#"^com\.obsproject\.Studio$"#
    default-column-width { proportion 1.0; }
    open-on-output "DP-2"
}

// Zen Browser and Zed settings
window-rule {
    match app-id=r#"^(firefox|dev\.zed\.Zed)$"#
    opacity 0.98
    default-column-width { proportion 0.75; }
}

// Web apps and Steam opacity
window-rule {
    match app-id=r#"^(steam|chrome-app\.restream\.io__home-Default|chrome-claude\.ai__new-Default|chrome-github\.com__-Default|chrome-gitlab\.com__theblackdon_black-don-os-Default|chrome-mail\.proton\.me__u_0_inbox-Default|chrome-meet\.google\.com__-Default|chrome-messages\.google\.com__web_u_1_conversations-Default|chrome-web\.descript\.com__-Default)$"#
    opacity 0.95
}

// Commented out: Steam fullscreen rule
/-window-rule {
    match app-id="steam"
    exclude title="^Steam$"
    open-fullscreen true
}


spawn-at-startup "bash" "-c" "wl-paste --watch cliphist store &"
spawn-at-startup "bash" "-c" "swww-daemon && sleep 1 && swww img '~/Pictures/Wallpapers/wallpaper.png'"
spawn-at-startup "wal" "-R"
spawn-at-startup "/usr/lib/mate-polkit/polkit-mate-authentication-agent-1"
spawn-at-startup "vesktop"
spawn-at-startup "Telegram"

// =======================
// Environment / Misc
// =======================

environment {
    XDG_CURRENT_DESKTOP "niri"
    GTK_USE_PORTAL "1"
    MOZ_ENABLE_WAYLAND "1"
    QT_QPA_PLATFORM "wayland"
    ELECTRON_OZONE_PLATFORM_HINT "wayland"
    QT_QPA_PLATFORMTHEME "gtk3"
    QT_QPA_PLATFORMTHEME_QT6 "gtk3"
    TERMINAL "kitty"
    XCURSOR_THEME "Bibata-Modern-Ice"
    XCURSOR_SIZE "24"

    // NVIDIA Gaming Optimizations (harmless if you don't use NVIDIA/Proton)
    __GL_GSYNC_ALLOWED "1"
    __GL_VRR_ALLOWED "1"
    PROTON_ENABLE_NVAPI "1"
    PROTON_HIDE_NVIDIA_GPU "0"
    PROTON_ENABLE_NGX_UPDATER "1"
}

hotkey-overlay {
    skip-at-startup
}

prefer-no-csd

screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"
